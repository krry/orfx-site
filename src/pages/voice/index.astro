---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';

const voiceDrafts = (await getCollection('voice-drafts'))
  .filter(draft => draft.data.status === 'published')
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime());

// Group by year
const grouped = voiceDrafts.reduce((acc, draft) => {
  const year = draft.data.date.getFullYear().toString();
  if (!acc[year]) acc[year] = [];
  acc[year].push(draft);
  return acc;
}, {} as Record<string, typeof voiceDrafts>);
---

<Layout title="Voice â€” orfx" description="All voice drafts and philosophical reflections.">
  <div class="space-y-12">
    <section class="space-y-4">
      <h1>Voice Drafts</h1>
      <p class="text-slate-400">
        Raw reflections. Unpolished musings. Witness to constellation.
      </p>
    </section>

    {Object.entries(grouped).sort(([a], [b]) => parseInt(b) - parseInt(a)).map(([year, drafts]) => (
      <section key={year} class="space-y-4">
        <h2 class="text-xl text-slate-400">{year}</h2>
        <ul class="space-y-3">
          {drafts.map(draft => (
            <li key={draft.slug} class="border-l-2 border-slate-800 hover:border-amber-400 pl-4 transition">
              <a href={`/voice/${draft.slug}`} class="group block">
                <span class="text-sm text-slate-500 group-hover:text-slate-400">
                  {draft.data.date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}
                </span>
                <h3 class="text-lg font-bold text-amber-400 group-hover:text-amber-300">
                  {draft.data.title}
                </h3>
                <p class="text-slate-400 text-sm">{draft.data.description}</p>
              </a>
            </li>
          ))}
        </ul>
      </section>
    ))}
  </div>
</Layout>
